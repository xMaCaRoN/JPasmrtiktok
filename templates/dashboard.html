{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h1><i class="fas fa-tachometer-alt"></i> ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</h1>
        
        <!-- Daily Auto Schedule System -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card bg-gradient-success text-white">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h4><i class="fas fa-calendar-alt"></i> üìÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h4>
                                <p class="mb-0">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏ß‡∏±‡∏ô‡∏•‡∏∞ 1 ‡∏Ñ‡∏•‡∏¥‡∏õ ‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà engagement ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</p>
                                <div id="scheduleStatus" class="mt-2">
                                    <small><i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞...</small>
                                </div>
                            </div>
                            <div class="col-md-4 text-end">
                                <button class="btn btn-light btn-lg me-2" onclick="enableDailyAuto()" id="enableBtn">
                                    <i class="fas fa-play"></i> ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                                </button>
                                <button class="btn btn-outline-light" onclick="disableDailyAuto()" id="disableBtn">
                                    <i class="fas fa-pause"></i> ‡∏õ‡∏¥‡∏î
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Weekly Schedule Table -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-clock"></i> ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th width="20%">‡∏ß‡∏±‡∏ô</th>
                                        <th width="25%">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ (‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏ó‡∏¢)</th>
                                        <th width="20%">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ</th>
                                        <th width="25%">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•</th>
                                        <th width="10%">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>üîµ ‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå</strong></td>
                                        <td><span class="badge bg-primary">19:00 ‚Äì 20:00 ‡∏ô.</span></td>
                                        <td><code>19:30</code></td>
                                        <td><small>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå ‡∏Ñ‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡πÄ‡∏¢‡∏≠‡∏∞</small></td>
                                        <td><i class="fas fa-circle text-success" title="Active"></i></td>
                                    </tr>
                                    <tr>
                                        <td><strong>üü† ‡∏ß‡∏±‡∏ô‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£</strong></td>
                                        <td><span class="badge bg-warning">16:00 ‚Äì 17:00 ‡∏ô.</span></td>
                                        <td><code>16:30</code></td>
                                        <td><small>‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏•‡∏¥‡∏Å‡∏á‡∏≤‡∏ô scroll TikTok</small></td>
                                        <td><i class="fas fa-circle text-success" title="Active"></i></td>
                                    </tr>
                                    <tr>
                                        <td><strong>üü¢ ‡∏ß‡∏±‡∏ô‡∏û‡∏∏‡∏ò</strong></td>
                                        <td><span class="badge bg-success">17:00 ‚Äì 18:00 ‡∏ô.</span></td>
                                        <td><code>17:30</code></td>
                                        <td><small>‡∏Å‡∏•‡∏≤‡∏á‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå engagement ‡∏î‡∏µ</small></td>
                                        <td><i class="fas fa-circle text-success" title="Active"></i></td>
                                    </tr>
                                    <tr>
                                        <td><strong>üü° ‡∏ß‡∏±‡∏ô‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ</strong></td>
                                        <td><span class="badge bg-info">17:00 ‚Äì 18:00 ‡∏ô.</span></td>
                                        <td><code>17:30</code></td>
                                        <td><small>‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡∏™‡∏π‡πà‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</small></td>
                                        <td><i class="fas fa-circle text-success" title="Active"></i></td>
                                    </tr>
                                    <tr>
                                        <td><strong>üî¥ ‡∏ß‡∏±‡∏ô‡∏®‡∏∏‡∏Å‡∏£‡πå</strong></td>
                                        <td><span class="badge bg-danger">16:00 ‚Äì 17:00 ‡∏ô.</span></td>
                                        <td><code>16:30</code></td>
                                        <td><small>TGIF! ‡∏Ñ‡∏ô‡∏î‡∏π‡πÄ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</small></td>
                                        <td><i class="fas fa-circle text-success" title="Active"></i></td>
                                    </tr>
                                    <tr>
                                        <td><strong>üü£ ‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå</strong></td>
                                        <td><span class="badge bg-secondary">17:00 ‚Äì 18:00 ‡∏ô.</span></td>
                                        <td><code>17:30</code></td>
                                        <td><small>‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î ‡∏Ñ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô</small></td>
                                        <td><i class="fas fa-circle text-success" title="Active"></i></td>
                                    </tr>
                                    <tr>
                                        <td><strong>üî∂ ‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå</strong></td>
                                        <td><span class="badge bg-dark">20:00 ‚Äì 21:00 ‡∏ô.</span></td>
                                        <td><code>20:30</code></td>
                                        <td><small>‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå</small></td>
                                        <td><i class="fas fa-circle text-success" title="Active"></i></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="alert alert-info mt-3">
                            <i class="fas fa-info-circle"></i>
                            <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢ (GMT+7) ‡πÅ‡∏•‡∏∞‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå engagement rate ‡∏Ç‡∏≠‡∏á TikTok ASMR content
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Auto Actions -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card bg-gradient-primary text-white">
                    <div class="card-body">
                        <h4><i class="fas fa-magic"></i> ü§ñ Manual Auto Mode</h4>
                        <p class="mb-3">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ ASMR ‡πÅ‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡∏ô‡∏≠‡∏Å‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô)</p>
                        <div class="d-flex gap-2 flex-wrap">
                            <button class="btn btn-light btn-lg" onclick="createAutoJob()">
                                <i class="fas fa-play-circle"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á 1 ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ AUTO
                            </button>
                            <button class="btn btn-outline-light" onclick="createMassAutoJobs(3)">
                                <i class="fas fa-rocket"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á 3 ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠
                            </button>
                            <button class="btn btn-outline-light" onclick="createMassAutoJobs(5)">
                                <i class="fas fa-fire"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á 5 ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠
                            </button>
                        </div>
                        <small class="mt-2 d-block opacity-75">
                            üéØ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏∏‡πà‡∏°: Glass Fruit Cutting, Creative Materials, Satisfying Textures
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card bg-primary text-white">
                    <div class="card-body">
                        <h5>‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h5>
                        <h2>{{ jobs|length }}</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-success text-white">
                    <div class="card-body">
                        <h5>‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h5>
                        <h2>{{ jobs|selectattr('status', 'equalto', 'completed')|list|length }}</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-info text-white">
                    <div class="card-body">
                        <h5>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ô</h5>
                        <h2>{{ jobs|selectattr('status', 'equalto', 'running')|list|length }}</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-danger text-white">
                    <div class="card-body">
                        <h5>‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</h5>
                        <h2>{{ jobs|selectattr('status', 'equalto', 'failed')|list|length }}</h2>
                    </div>
                </div>
            </div>
        </div>

        <!-- Jobs ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î -->
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-clock"></i> Jobs ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h5>
            </div>
            <div class="card-body">
                {% if jobs %}
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                <th>‡∏£‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th>
                                <th>‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for job in jobs[:5] %}
                            <tr>
                                <td>
                                    <a href="{{ url_for('job_detail', job_id=job.id) }}">{{ job.name }}</a>
                                </td>
                                <td>
                                    <span class="badge status-{{ job.status }}">{{ job.status }}</span>
                                </td>
                                <td>{{ job.last_run or '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏£‡∏±‡∏ô' }}</td>
                                <td>
                                    <button class="btn btn-sm btn-primary" onclick="runJob('{{ job.id }}')">
                                        <i class="fas fa-play"></i> ‡∏£‡∏±‡∏ô‡πÄ‡∏•‡∏¢
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ jobs</p>
                <a href="{{ url_for('create_job') }}" class="btn btn-primary">‡∏™‡∏£‡πâ‡∏≤‡∏á Job ‡πÅ‡∏£‡∏Å</a>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ scheduler ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
document.addEventListener('DOMContentLoaded', function() {
    loadScheduleStatus();
    
    // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏ó‡∏∏‡∏Å 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
    setInterval(loadScheduleStatus, 30000);
    
    // Auto refresh ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ jobs ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ô
    checkRunningJobs();
});

function checkRunningJobs() {
    // ‡∏ô‡∏±‡∏ö jobs ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ô
    const runningJobsCount = {{ jobs|selectattr('status', 'equalto', 'running')|list|length|tojson }};
    
    if (runningJobsCount > 0) {
        // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        setInterval(() => {
            location.reload();
        }, 10000);
    }
}

function loadScheduleStatus() {
    fetch('/schedule_status')
        .then(response => response.json())
        .then(data => {
            const statusDiv = document.getElementById('scheduleStatus');
            
            if (data.scheduled_jobs_count > 0) {
                statusDiv.innerHTML = `
                    <div class="d-flex align-items-center">
                        <i class="fas fa-check-circle text-success me-2"></i>
                        <span><strong>‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</strong> - ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: <strong>${data.next_upload.weekday}</strong> 
                        ‡πÄ‡∏ß‡∏•‡∏≤ <strong>${data.next_upload.datetime.split(' ')[1].substring(0,5)}</strong> 
                        (‡∏≠‡∏µ‡∏Å ${data.next_upload.hours_until} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</span>
                    </div>
                `;
                document.getElementById('enableBtn').innerHTML = '<i class="fas fa-sync"></i> ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï';
            } else {
                statusDiv.innerHTML = `
                    <div class="d-flex align-items-center">
                        <i class="fas fa-pause-circle text-warning me-2"></i>
                        <span><strong>‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</strong> - ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</span>
                    </div>
                `;
                document.getElementById('enableBtn').innerHTML = '<i class="fas fa-play"></i> ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
            }
        })
        .catch(error => {
            console.error('Error loading schedule status:', error);
            document.getElementById('scheduleStatus').innerHTML = 
                '<i class="fas fa-exclamation-triangle text-danger"></i> ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏î‡πâ';
        });
}

function enableDailyAuto() {
    const btn = document.getElementById('enableBtn');
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤...';
    
    fetch('/enable_daily_auto', { method: 'POST' })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(`‚úÖ ${data.message}\n\nüìÖ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: ${data.next_upload.weekday}\n‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤: ${data.next_upload.time}\nüïí ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤: ${data.next_upload.range}`);
                loadScheduleStatus();
            } else {
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + data.error);
            }
        })
        .catch(error => {
            alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
        })
        .finally(() => {
            btn.disabled = false;
        });
}

function disableDailyAuto() {
    if (confirm('‚ö†Ô∏è ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n\n‡∏à‡∏∞‡∏´‡∏¢‡∏∏‡∏î‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î')) {
        const btn = document.getElementById('disableBtn');
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î...';
        
        fetch('/disable_daily_auto', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('‚èπÔ∏è ' + data.message);
                    loadScheduleStatus();
                } else {
                    alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + data.error);
                }
            })
            .catch(error => {
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            })
            .finally(() => {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-pause"></i> ‡∏õ‡∏¥‡∏î';
            });
    }
}

function createAutoJob() {
    if (confirm('ü§ñ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ ASMR ‡πÅ‡∏ö‡∏ö AUTO ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n\n‚ú® ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏∏‡πà‡∏° prompt ‡πÄ‡∏≠‡∏á\nüé¨ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏î‡πâ‡∏ß‡∏¢ AI\nüì± ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î TikTok ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥')) {
        const btn = event.target;
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á...';
        
        fetch('/auto_create', { 
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('‚úÖ ' + data.message);
                setTimeout(() => location.reload(), 1000);
            } else {
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + data.error);
            }
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-play-circle"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á 1 ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ AUTO';
        });
    }
}

function createMassAutoJobs(count) {
    if (confirm(`üöÄ ‡∏™‡∏£‡πâ‡∏≤‡∏á ${count} ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ ASMR ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n\n‚ö° ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${count * 2} ‡∏ô‡∏≤‡∏ó‡∏µ\nüéØ ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô`)) {
        const btn = event.target;
        btn.disabled = true;
        btn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á ${count} ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠...`;
        
        fetch('/mass_auto_create', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ count: count })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(`üéâ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á ${data.count} ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÅ‡∏•‡πâ‡∏ß!\n\n‡∏î‡∏π‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Jobs`);
                setTimeout(() => location.reload(), 1000);
            } else {
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + data.error);
            }
            btn.disabled = false;
            btn.innerHTML = `<i class="fas fa-fire"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á ${count} ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠`;
        });
    }
}

function runJob(jobId) {
    if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô job ‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
        fetch(`/run_job/${jobId}`, { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏±‡∏ô job ‡πÅ‡∏•‡πâ‡∏ß');
                    location.reload();
                } else {
                    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + data.error);
                }
            });
    }
}

// Auto refresh ‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ jobs ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ô
const runningJobsCount = {{ jobs|selectattr('status', 'equalto', 'running')|list|length|tojson }};
if (runningJobs > 0) {
    setInterval(() => {
        location.reload();
    }, 10000);
}
</script>
{% endblock %}