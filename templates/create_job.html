{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <!-- Mode Selection -->
        <div class="card mb-4">
            <div class="card-body text-center">
                <h2><i class="fas fa-plus"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á Auto-Job ‡πÉ‡∏´‡∏°‡πà</h2>
                <p class="text-muted mb-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ ASMR</p>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="card border-primary h-100" id="autoCard">
                            <div class="card-body text-center">
                                <i class="fas fa-magic fa-3x text-primary mb-3"></i>
                                <h4>ü§ñ Full Auto Mode</h4>
                                <p class="text-muted">‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏á<br>‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏¢!</p>
                                <ul class="list-unstyled text-start">
                                    <li>‚úÖ ‡∏™‡∏∏‡πà‡∏° prompt ASMR ‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°</li>
                                    <li>‚úÖ ‡∏™‡∏∏‡πà‡∏° Glass Fruit / Creative Materials</li>
                                    <li>‚úÖ ‡∏™‡∏∏‡πà‡∏° caption ‡πÅ‡∏•‡∏∞ hashtags</li>
                                    <li>‚úÖ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î TikTok ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</li>
                                </ul>
                                <button class="btn btn-primary" onclick="selectMode('auto')">
                                    ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Auto Mode
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card border-secondary h-100" id="manualCard">
                            <div class="card-body text-center">
                                <i class="fas fa-edit fa-3x text-secondary mb-3"></i>
                                <h4>‚úèÔ∏è Manual Mode</h4>
                                <p class="text-muted">‡∏Å‡∏≥‡∏´‡∏ô‡∏î prompt ‡πÄ‡∏≠‡∏á<br>‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</p>
                                <ul class="list-unstyled text-start">
                                    <li>‚úèÔ∏è ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô prompt ‡πÄ‡∏≠‡∏á</li>
                                    <li>‚è∞ ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏±‡∏ô‡πÄ‡∏≠‡∏á</li>
                                    <li>üéØ ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</li>
                                    <li>üé® ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞</li>
                                </ul>
                                <button class="btn btn-secondary" onclick="selectMode('manual')">
                                    ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Manual Mode
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Auto Mode Form -->
        <div class="card" id="autoForm" style="display: none;">
            <div class="card-header bg-primary text-white">
                <h3><i class="fas fa-magic"></i> ü§ñ Full Auto Mode</h3>
            </div>
            <div class="card-body">
                <form id="autoJobForm">
                    <div class="mb-3">
                        <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠ Job</label>
                        <input type="text" class="form-control" name="name" 
                               placeholder="Auto ASMR Job" value="Auto ASMR Job">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏±‡∏ô</label>
                        <select class="form-control" name="schedule_time" required>
                            <option value="manual">‡∏£‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á</option>
                            <option value="hourly">‡∏ó‡∏∏‡∏Å‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                            <option value="daily">‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô (09:00)</option>
                            <option value="weekly">‡∏ó‡∏∏‡∏Å‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</option>
                        </select>
                    </div>

                    <div class="alert alert-info">
                        <h5><i class="fas fa-info-circle"></i> ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏∏‡πà‡∏°‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥:</h5>
                        <div class="row">
                            <div class="col-md-4">
                                <strong>üçì Glass Fruits:</strong>
                                <ul class="small mb-0">
                                    <li>Glass Strawberry</li>
                                    <li>Glass Mango</li>
                                    <li>Glass Banana</li>
                                    <li>Glass Watermelon</li>
                                    <li>Glass Apple</li>
                                </ul>
                            </div>
                            <div class="col-md-4">
                                <strong>‚ú® Creative Materials:</strong>
                                <ul class="small mb-0">
                                    <li>Solid Gold</li>
                                    <li>Crystal Ice</li>
                                    <li>Rainbow Soap</li>
                                    <li>Kinetic Sand</li>
                                    <li>Amber Honeycomb</li>
                                </ul>
                            </div>
                            <div class="col-md-4">
                                <strong>üßà Satisfying Textures:</strong>
                                <ul class="small mb-0">
                                    <li>Rainbow Butter</li>
                                    <li>Jelly Cubes</li>
                                    <li>Modeling Clay</li>
                                    <li>Magnetic Putty</li>
                                    <li>Foam Blocks</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button type="button" class="btn btn-secondary" onclick="backToSelection()">‡∏Å‡∏•‡∏±‡∏ö</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-magic"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á Auto Job
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Manual Mode Form -->
        <div class="card" id="manualForm" style="display: none;">
            <div class="card-header bg-secondary text-white">
                <h3><i class="fas fa-edit"></i> ‚úèÔ∏è Manual Mode</h3>
            </div>
            <div class="card-body">
                <form id="manualJobForm">
                    <div class="mb-3">
                        <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠ Job</label>
                        <input type="text" class="form-control" name="name" required 
                               placeholder="‡πÄ‡∏ä‡πà‡∏ô Daily Fruit ASMR Video">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Prompt ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</label>
                        <textarea class="form-control" name="prompt" rows="6" required 
                                  placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ ASMR ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£..."></textarea>
                        <div class="form-text">
                            <strong>üî• ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Prompt ‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°:</strong><br>
                            <button type="button" class="btn btn-outline-primary btn-sm mt-1" onclick="fillPrompt('glass_strawberry')">Glass Strawberry</button>
                            <button type="button" class="btn btn-outline-info btn-sm mt-1" onclick="fillPrompt('gold_cutting')">Gold Cutting</button>
                            <button type="button" class="btn btn-outline-success btn-sm mt-1" onclick="fillPrompt('rainbow_butter')">Rainbow Butter</button>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏±‡∏ô</label>
                        <select class="form-control" name="schedule_time" required>
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤</option>
                            <option value="hourly">‡∏ó‡∏∏‡∏Å‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                            <option value="daily">‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô (09:00)</option>
                            <option value="weekly">‡∏ó‡∏∏‡∏Å‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</option>
                            <option value="manual">‡∏£‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á</option>
                        </select>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button type="button" class="btn btn-secondary" onclick="backToSelection()">‡∏Å‡∏•‡∏±‡∏ö</button>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á Manual Job
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á prompts
const samplePrompts = {
    glass_strawberry: "A hyper-realistic cinematic close-up of a whole, full-shaped glass strawberry with a soft red translucent hue. The glass fruit is perfectly centred on a wooden cutting board, glowing subtly under studio lighting. A human hand is clearly visible, holding a sharp stainless steel knife just above the fruit, ready to slice. In slow motion, the knife makes clean slices through the glass fruit, creating delicate glass-crack sounds. Transparent shards scatter lightly. ASMR slicing sounds only. Ultra-sharp macro lens, shallow depth of field.",
    
    gold_cutting: "A glowing chunk of solid gold being sliced with a heated knife. Each cut creates sharp, crisp snapping sounds like breaking delicate shells. Golden shards scatter as the surface cracks cleanly, blending satisfying crunch with molten smoothness. Warm studio lighting enhances the golden glow. Professional cinematography with macro lens.",
    
    rainbow_butter: "Ultra-satisfying scene of vibrant pastel rainbow butter being gently spread across warm crispy toast. The knife glides smoothly, creating perfect ridges and swirls. Soft spreading sounds and gentle sizzling from the warm bread. Close-up macro shot with natural lighting."
};

function selectMode(mode) {
    // ‡∏ã‡πà‡∏≠‡∏ô selection cards
    document.getElementById('autoCard').parentElement.parentElement.style.display = 'none';
    
    if (mode === 'auto') {
        document.getElementById('autoForm').style.display = 'block';
        document.getElementById('manualForm').style.display = 'none';
    } else {
        document.getElementById('autoForm').style.display = 'none';
        document.getElementById('manualForm').style.display = 'block';
    }
}

function backToSelection() {
    document.getElementById('autoCard').parentElement.parentElement.style.display = 'block';
    document.getElementById('autoForm').style.display = 'none';
    document.getElementById('manualForm').style.display = 'none';
}

function fillPrompt(type) {
    const textarea = document.querySelector('#manualForm textarea[name="prompt"]');
    textarea.value = samplePrompts[type];
}

// Auto Form Submit
document.getElementById('autoJobForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const data = Object.fromEntries(formData.entries());
    data.prompt = 'auto'; // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô auto mode
    
    const submitBtn = this.querySelector('button[type="submit"]');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Auto Job...';
    
    fetch('/create_job', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('ü§ñ ‡∏™‡∏£‡πâ‡∏≤‡∏á Auto Job ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏∏‡πà‡∏° prompt ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥');
            window.location.href = '/jobs';
        } else {
            alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + data.error);
        }
    })
    .catch(error => {
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
    })
    .finally(() => {
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-magic"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á Auto Job';
    });
});

// Manual Form Submit  
document.getElementById('manualJobForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const data = Object.fromEntries(formData.entries());
    
    const submitBtn = this.querySelector('button[type="submit"]');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Job...';
    
    fetch('/create_job', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á Job ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
            window.location.href = '/jobs';
        } else {
            alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + data.error);
        }
    })
    .catch(error => {
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
    })
    .finally(() => {
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-save"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á Manual Job';
    });
});
</script>
{% endblock %}